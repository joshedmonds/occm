---
sidebar: sidebar
permalink: task_adding_gcp_accounts.html
keywords: permissions, gcp, marketplace, gcp subscription, subscription, gcp marketplace, subscribe, data tiering, tiering, setup, requirements, account for data tiering, account for tiering, interoperable, interoperability, interoperable storage access keys, access keys
summary: You can manage two types of Google Cloud Platform credentials from Cloud Manager the credentials that are associated with the Connector VM instance and storage access keys used with a Cloud Volumes ONTAP 9.6 system for data tiering.
---

= Managing GCP credentials and subscriptions for Cloud Manager
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
You can manage two types of Google Cloud Platform credentials from Cloud Manager: the credentials that are associated with the Connector VM instance and storage access keys used with a Cloud Volumes ONTAP 9.6 system for link:concept_data_tiering.html[data tiering].

== Associating a Marketplace subscription with GCP credentials

When you deploy a Connector in GCP, Cloud Manager creates a default set of credentials that are associated with the Connector VM instance. These are the credentials that Cloud Manager uses to deploy Cloud Volumes ONTAP.

At any time, you can change the Marketplace subscription that's associated with these credentials. The subscription enables you to create a pay-as-you-go Cloud Volumes ONTAP system, and to use other NetApp cloud services.

.Steps

. In the upper right of the Cloud Manager console, click the Settings icon, and select *Credentials*.

. Hover over a set of credentials and click the action menu.

. From the menu, click *Associate Subscription*.
+
image:screenshot_gcp_add_subscription.gif[A screenshot of the Credentials page where you can add a subscription to GCP credentials from the menu.]

. Select a Google Cloud project and subscription from the down-down list.
+
image:screenshot_gcp_associate.gif[A screenshot of a Google Cloud project and subscription selected for Google Cloud credentials.]

. Click *Associate*.

. Alternatively, if you do not already have a subscription, click *Add Subscription* and follow the steps to create a new subscription below.
+
NOTE: Before you complete the following steps, ensure that you have both Billing Admin in your Google Cloud account as well as a NetApp Cloud Central account.

. A pop-up will appear outlining the subscription steps. Click *Continue* here.
+
image:screenshot_gcp_sub_popup.png[A screenshot of a subscription pop-up.]

. You will be redirected to the https://console.cloud.google.com/marketplace/product/netapp-cloudmanager/cloud-manager[NetApp Cloud Manager Google marketplace page^]. *Ensure that the correct project is selected* at the top navigation menu.
+
image:screenshot_gcp_cvo_marketplace.png[A screenshot of the GCP CVO marketplace page.]

. Click *Subscribe*.

. Select the appropriate billing account and *agree to the Terms and Conditions*.
+
image:screenshot_gcp_terms_and_conditions.png[A screenshot of the GCP terms and conditions.]

. Click *Subscribe*.

. A pop-up will appear, click *Register with NetApp inc.* to be redirected back to NetApp Cloud Central.
+
image:screenshot_gcp_marketplace_register.png[A screenshot of a registration pop-up.]
+
NOTE: Please note that this stage will have to be completed in order to link the GCP subscription to your NetApp account. The process of linking a subscription will not be complete until you sign in to a NetApp cloud central account and are redirected from this page.

. You will be redirected to: https://services.cloud.netapp.com/subscription-mapping in a new browser tab. If you are not signed in to a NetApp cloud central account already, you will be prompted to do so. If you do not have an account, you will be prompted to sign up for a new one. Please follow those steps, then click *Done* to proceed. The GCP subscription will be linked to all Cloud Central accounts that your user login is associated with.
+
image:screenshot_gcp_sub_mapping.png[A screenshot of mapping GCP subscription to NetApp cloud central account.]
+
NOTE: If somebody from your organization has already subscribed to the NetApp Cloud Manager subscription from your billing account, you will be redirected to https://cloud.netapp.com/ontap-cloud?x-gcp-marketplace-token= instead. If this is unexpected, please contact your NetApp sales team. Google enables only 1 subscription per Google billing account.

. Once this process is complete, navigate back to the credentials page and your new subscription will be available to choose.
+
image:screenshot_gcp_associate.gif[A screenshot of the subscription assignment page.]

=== Associating a Marketplace subscription with GCP credentials Troubleshooting

Sometimes, subscribing to Cloud Volumes ONTAP through the Google marketplace can become fragmented due to incorrect permissions or accidentally not following the redirection to NetApp Cloud Central. Please follow the following steps to complete the subscription process.

.Steps

. Navigate to the https://console.cloud.google.com/marketplace/product/netapp-cloudmanager/cloud-manager[NetApp Cloud Manager Google marketplace page^] to check on the state of the Order. If the page states *Manage on Provider* on the page, scroll down and click *Manage Orders*.
+
image:screenshot_gcp_manage_orders.png[A screenshot of the marketplace page post subscription.]

.. *Choose the correct Billing Account*. If the order shows a Green Check mark and this is unexpected, somebody else from the organization using the same billing account may already be subscribed. If this is unexpected or you require the details of this subscription, please contact your NetApp sales team.
+
image:screenshot_gcp_green_marketplace.png[A screenshot of an accepted entitlement.]

.. *Choose the correct Billing Account*. If the order shows a clock and *Pending* under status, go back to the marketplace page and choose *Manage on Provider* to complete the process as documented above.
+
image:screenshot_gcp_pending_marketplace.png[A screenshot of a pending marketplace entitlement.]

== Setting up and adding GCP accounts for data tiering with Cloud Volumes ONTAP 9.6

If you want to enable a Cloud Volumes ONTAP 9.6 system for link:concept_data_tiering.html[data tiering], you need to provide Cloud Manager with a storage access key for a service account that has Storage Admin permissions. Cloud Manager uses the access keys to set up and manage a Cloud Storage bucket for data tiering.

TIP: If you want to use data tiering with Cloud Volumes ONTAP 9.7 or later, then follow step 4 in link:task_getting_started_gcp.html[Getting started with Cloud Volumes ONTAP in Google Cloud Platform].

=== Setting up a service account and access keys for Google Cloud Storage

A service account enables Cloud Manager to authenticate and access Cloud Storage buckets used for data tiering. The keys are required so that Google Cloud Storage knows who is making the request.

.Steps

. Open the GCP IAM console and https://cloud.google.com/iam/docs/creating-custom-roles#creating_a_custom_role[create a service account that has the Storage Admin role^].
+
image:screenshot_gcp_service_account_role.gif[A screenshot of the GCP IAM console that shows the selection of the Storage Admin role for a service account.]

. Go to https://console.cloud.google.com/storage/settings[GCP Storage Settings^].

. If you're prompted, select a project.

. Click the *Interoperability* tab.

. If you haven't already done so, click *Enable interoperability access*.

. Under *Access keys for service accounts*, click *Create a key for a service account*.

. Select the service account that you created in step 1.
+
image:screenshot_gcp_access_key.gif[A screenshot of the GCP storage console that shows a selected service account for a new access key.]

. Click *Create Key*.

. Copy the access key and secret.
+
You'll need to enter this information in Cloud Manager when you add the GCP account for data tiering.

=== Adding a GCP account to Cloud Manager

Now that you have an access key for a service account, you can add it to Cloud Manager.

.What you'll need

You need to create a Connector before you can change Cloud Manager settings. link:concept_connectors.html#how-to-create-a-connector[Learn how].

.Steps

. In the upper right of the Cloud Manager console, click the Settings icon, and select *Credentials*.
+
image:screenshot_settings_icon.gif[A screenshot that shows the Settings icon in the upper right of the Cloud Manager console.]

. Click *Add Credentials* and select *Google Cloud*.

. Enter the access key and secret for the service account.
+
The keys enable Cloud Manager to set up a Cloud Storage bucket for data tiering.

. Confirm that the policy requirements have been met and then click *Create Account*.

.What's next?

You can now enable data tiering on individual volumes on a Cloud Volumes ONTAP 9.6 system when you create, modify, or replicate them. For details, see link:task_tiering.html[Tiering inactive data to low-cost object storage].

But before you do, be sure that the subnet in which Cloud Volumes ONTAP resides is configured for Private Google Access. For instructions, refer to https://cloud.google.com/vpc/docs/configure-private-google-access[Google Cloud Documentation: Configuring Private Google Access^].
